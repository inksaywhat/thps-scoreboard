<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-800 text-white flex flex-col items-center justify-center h-screen font-sans">

    <div class="text-center p-8 bg-gray-900 rounded-lg shadow-xl">
        <h1 class="text-4xl font-bold mb-4">Connection Test</h1>
        <button id="test-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-xl">
            Click to Write to Database
        </button>
        <div id="status" class="mt-6 text-lg">Waiting for connection...</div>
    </div>

    <!-- Firebase and App Logic -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const statusEl = document.getElementById('status');
        const testButton = document.getElementById('test-button');

        function updateStatus(message, isError = false) {
            console.log(message);
            statusEl.textContent = message;
            statusEl.className = isError ? 'mt-6 text-lg text-red-500' : 'mt-6 text-lg text-green-500';
        }

        try {
            updateStatus('Script loaded. Initializing Firebase...');
            
            // --- Your NEW, Correct Firebase Config ---
            const firebaseConfig = {
              apiKey: "AIzaSyCuxj9XsAyWkNCAQVpd7YWio51wESun96s",
              authDomain: "thps-final-scoreboard.firebaseapp.com",
              projectId: "thps-final-scoreboard",
              storageBucket: "thps-final-scoreboard.appspot.com",
              messagingSenderId: "596724238233",
              appId: "1:596724238233:web:221eb7a63ff51fe04eb508"
            };
            
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            updateStatus('Firebase initialized. Setting up auth listener...');

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    updateStatus(`Authenticated successfully! UID: ${user.uid}`);
                    testButton.disabled = false;
                    testButton.onclick = async () => {
                        updateStatus('Button clicked! Attempting to write to database...');
                        const testDocRef = doc(db, "test", `test-doc-${Date.now()}`);
                        try {
                            await setDoc(testDocRef, {
                                message: "Hello, Firebase!",
                                timestamp: serverTimestamp()
                            });
                            updateStatus('SUCCESS! Document written to Firestore!');
                        } catch (error) {
                            updateStatus(`ERROR writing document: ${error.message}`, true);
                        }
                    };
                } else {
                    updateStatus('User not authenticated. Signing in anonymously...');
                    signInAnonymously(auth).catch(authError => {
                        updateStatus(`CRITICAL SIGN-IN FAILED: ${authError.message}`, true);
                    });
                }
            });
        } catch (e) {
            updateStatus(`FATAL SCRIPT ERROR: ${e.message}`, true);
        }
    </script>

</body>
</html>
